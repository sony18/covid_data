const date_div=document.querySelector(".date"),header_chart=document.querySelector("#header__chart"),list_ul=document.querySelector("#list"),updated_date=document.querySelector("#update_date"),countries_select=document.querySelector("#countries"),country_title=document.querySelector(".country__title");let url="https://covid19.mathdro.id/api";const format=e=>e<10?"0"+e:e;setInterval(()=>{let e=new Date;const t=format(e.getHours()),a=format(e.getMinutes()),r=format(e.getSeconds());date_div.innerHTML=`${e.toDateString()} `,date_div.innerHTML+=`| ${t}:${a}:${r} <br/>`},1e3);const fetchCountry=async()=>{const e=await fetch(`${url}/countries`),{countries:t}=await e.json();return t},fetchData=async e=>{console.log(e);let t,a=url;try{(await fetchCountry()).forEach(a=>{if(a.iso3===e)return t=a.name}),e&&"global"!==e&&(a=`${url}/countries/${e}`);const r=await fetch(a),n=await r.json();console.log(n),uiUpdate(n,e,t),chartUi(n)}catch(e){console.log(e.message)}toggleChartVisibility(e)},uiUpdate=(e,t,a)=>{const{confirmed:r,deaths:n,recovered:o,lastUpdate:l}=e,i=new Date(l).toUTCString();country_title.innerHTML=t&&"global"!==t&&"undefined"!==t?a:"undefined"===t?"No records found...":"Global","undefined"===t&&e.error&&(list_ul.innerHTML=`<span class="red-text" >Error..missing country Tag. ${e.error.message}</span>`);const c=`<li class="btn btn-large  waves-effect waves-light yellow lighten-1 black-text">Confirmed : ${r.value}</li> <br/><br/>\n                    <li class="btn btn-large waves-effect waves-light red lighten-1  black-text">Death : ${n.value}</li><br/><br/>\n                    <li class="btn btn-large waves-effect waves-light green lighten-1 black-text"> Recovered : ${o.value}</li> `;list_ul.innerHTML=c,updated_date.innerHTML=` <strong> Last Updated: </strong> <small> ${i} </small>\n                         `},toggleChartVisibility=e=>{header_chart.style.visibility=e&&"global"!==e?"hidden":"visible"},chartUi=({confirmed:e,recovered:t,deaths:a,lastUpdate:r})=>{var n=document.getElementById("covidChart").getContext("2d");return new Chart(n,{type:"bar",data:{labels:["confirmed","recovered","deaths"],datasets:[{label:"global",data:[e.value,t.value,a.value],backgroundColor:["rgba(244, 288, 83,1)","rgba(0, 206, 0,0.5)","rgba(220, 52, 52,1)"],borderColor:["rgba(255, 206, 86, 1)","rgba(53, 202, 55, 1)","rgba(355, 62, 10, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,title:{display:!0,text:`Todays data (updated at: ${new Date(r).toLocaleTimeString()})`}}})},fillSelectList=async e=>{document.querySelectorAll("select");(await fetchCountry()).forEach(e=>countries_select.innerHTML+=` <option value="${e.iso3}" data-value="${e.name}">${e.name}</option>`.toString()),fetchData()};document.addEventListener("DOMContentLoaded",fillSelectList),countries_select.addEventListener("change",e=>{fetchData(e.target.value)});